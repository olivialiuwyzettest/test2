{% extends "base.html" %}

{% block content %}
<section class="card" style="margin-bottom: 1rem;">
  <h2>Wyze Latest Uses & Mentions</h2>
  <div class="meta">
    Prioritized by recency + relevance from news and public discussions.
    {% if last_refresh and last_refresh.completed_at %}
    Last refresh: {{ last_refresh.completed_at.strftime('%Y-%m-%d %H:%M UTC') }}
    {% endif %}
  </div>
</section>

<section class="card table-wrap">
  <table class="table">
    <thead>
      <tr>
        <th>Published</th>
        <th>Source</th>
        <th>Title</th>
        <th>Engagement</th>
        <th>Sentiment</th>
        <th>Relevance</th>
      </tr>
    </thead>
    <tbody>
      {% for item in items %}
      <tr>
        <td>{{ item.published_at.strftime('%Y-%m-%d %H:%M') }}</td>
        <td>{{ item.source_name }}</td>
        <td><a href="{{ item.url }}" target="_blank" rel="noopener noreferrer">{{ item.title }}</a></td>
        <td>{{ item.engagement_score }}</td>
        <td class="sentiment {{ 'positive' if item.sentiment_score >= 0.2 else 'negative' if item.sentiment_score <= -0.2 else 'neutral' }}">{{ '%.2f'|format(item.sentiment_score) }}</td>
        <td>{{ '%.2f'|format(item.relevance_score) }}</td>
      </tr>
      {% else %}
      <tr>
        <td colspan="6">No data yet.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</section>
{% endblock %}
