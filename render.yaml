databases:
  - name: wyze-rto-db
    databaseName: wyze_rto
    user: wyze_rto_user
    plan: free

services:
  - type: web
    name: wyze-rto-attendance
    runtime: node
    plan: free
    region: oregon
    repo: https://github.com/olivialiuwyzettest/test2.git
    branch: codex/wbr-deck-agent
    autoDeploy: true
    healthCheckPath: /login
    buildCommand: corepack enable && corepack prepare pnpm@10.29.2 --activate && pnpm install --frozen-lockfile --prod=false && pnpm db:generate && pnpm build
    startCommand: pnpm db:deploy && pnpm start -- -p $PORT -H 0.0.0.0
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: wyze-rto-db
          property: connectionString
      - key: APP_SHARED_ACCESS_CODE
        sync: false
      - key: APP_ALLOWED_EMAIL_DOMAINS
        value: wyze.com
      - key: APP_SESSION_SECRET
        generateValue: true
      - key: APP_DEFAULT_TIMEZONE
        value: America/Los_Angeles
      - key: APP_CRON_SECRET
        generateValue: true
      - key: BRIVO_MODE
        value: mock
      - key: BRIVO_WEBHOOK_MODE
        value: "false"
      - key: BRIVO_WEBHOOK_SECRET
        generateValue: true
      - key: BRIVO_ENTRY_EVENT_MARKERS
        value: OPEN,ACCESS_GRANTED,DOOR_OPEN,ACCESS-ALLOWED
      - key: BRIVO_AUTO_LINK_BY_EMAIL
        value: "false"
